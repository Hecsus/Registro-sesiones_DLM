<!DOCTYPE html>
<html lang="es">
  <!-- üí° Head con Bootstrap, estilos y t√≠tulo din√°mico -->
  <%- include('partials/head') %>

  <body>
    <!-- üß≠ Barra de navegaci√≥n -->
    <%- include('partials/header') %>

    <section class="container py-5">
      <div class="row justify-content-center">
        <div class="col-md-6 col-lg-5">
          <h2 class="text-center mb-4">Iniciar Sesi√≥n</h2>

          <!-- üîê Formulario de autenticaci√≥n -->
          <form action="/auth" method="POST" novalidate>
            <!-- üìõ Campo: Usuario -->
            <div class="mb-3">
              <input
                type="text"
                name="user"
                placeholder="Usuario"
                value="<%= oldData?.user || '' %>"
                class="form-control <%= errors.find(e => e.param === 'user') ? 'is-invalid' : '' %>"
                minlength="3"
                pattern="[a-zA-Z0-9]+"
                title="Debe tener al menos 3 caracteres alfanum√©ricos"
                required
              />
              <div class="form-text">Debe tener al menos 3 caracteres alfanum√©ricos</div>
              <% errors.forEach(e => { if (e.param === 'user') { %>
                <div class="invalid-feedback d-block"><%= e.msg %></div>
              <% }}) %>
            </div>

            <!-- üîí Campo: Contrase√±a -->
            <div class="mb-3">
              <input
                type="password"
                name="pass"
                placeholder="Contrase√±a"
                class="form-control <%= errors.find(e => e.param === 'pass') ? 'is-invalid' : '' %>"
                minlength="5"
                pattern="[a-zA-Z0-9]+"
                title="Debe tener al menos 5 caracteres alfanum√©ricos"
                required
              />
              <div class="form-text">Debe tener al menos 5 caracteres alfanum√©ricos</div>
              <% errors.forEach(e => { if (e.param === 'pass') { %>
                <div class="invalid-feedback d-block"><%= e.msg %></div>
              <% }}) %>
            </div>

            <!-- üîò Bot√≥n de enviar -->
            <button type="submit" class="btn btn-primary w-100">Entrar</button>
          </form>

          <!-- üîÅ Enlace para ir a registro -->
          <div class="text-center mt-3">
            <a href="/registro">¬øNo tienes cuenta? Reg√≠strate</a>
          </div>
        </div>
      </div>
    </section>

    <!-- üì¢ SweetAlert si hay alertas -->
    <% if (alert) { %>
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
      <script>
        Swal.fire({
          title: "<%= alertTitle %>",
          text: "<%= alertMessage %>",
          icon: "<%= alertIcon %>",
          showConfirmButton: <%= showConfirmButton %>,
          timer: <%= timer %>,
        }).then(() => {
          window.location = "/<%= ruta %>";
        });
      </script>
    <% } %>

    <!-- üì¶ Footer -->
    <%- include('partials/footer') %>

    <!-- ‚úîÔ∏è Validaci√≥n de campos en tiempo real -->
    <script>
      document.querySelectorAll("input").forEach(input => {
        input.addEventListener("input", () => {
          input.setCustomValidity("");
          if (!input.checkValidity()) {
            input.classList.add("is-invalid");
          } else {
            input.classList.remove("is-invalid");
          }
        });
      });
    </script>
  </body>
</html>
